<!DOCTYPE html>
<html lang="es">
<head>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸŸ</text></svg>">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mapa de Mesas - CevicheOS ğŸŸ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Estilo Modo Oscuro Elegante */
        body { background-color: #121212; color: #e0e0e0; font-family: 'Segoe UI', sans-serif; }

        .card-mesa {
            border: none;
            border-radius: 15px;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            height: 100%;
        }

        .card-mesa:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        /* Estados de Mesa */
        .mesa-libre {
            background: linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%);
            border-top: 5px solid #00c853; /* Borde Verde */
        }

        .mesa-ocupada {
            background: linear-gradient(135deg, #2c0b0e 0%, #3e1014 100%);
            border-top: 5px solid #ff1744; /* Borde Rojo */
        }

        .precio-pendiente {
            font-size: 2rem;
            font-weight: bold;
            color: #ff5252;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .badge-estado {
            font-size: 0.9rem;
            padding: 8px 12px;
            border-radius: 20px;
        }
    </style>
</head>
<body>

    <!-- Encabezado Minimalista -->
    <nav class="navbar navbar-dark bg-dark mb-5 border-bottom border-secondary">
        <div class="container">
            <span class="navbar-brand mb-0 h1 fw-bold">ğŸŸ CevicheOS <span class="badge bg-primary ms-2">v1.0</span></span>
            <span class="text-secondary small">
                {% if user.is_authenticated %}
                    Usuario: {{ user.username }}
                {% else %}
                    <a href="{% url 'login' %}" class="text-decoration-none text-info">Iniciar SesiÃ³n</a>
                {% endif %}
            </span>
        </div>
    </nav>

    <div class="container">
        <h2 class="text-center mb-4 text-white fw-light">ğŸ—ºï¸ Mapa de Mesas en Tiempo Real</h2>

        <!-- ZONA DE ADMINISTRACIÃ“N (Solo visible para el Jefe) -->
        <!-- Lo ponemos aquÃ­, justo debajo del tÃ­tulo -->
        {% if user.is_staff %}
            <div class="d-flex justify-content-center gap-3 mb-5 animate__animated animate__fadeInDown">

                <!-- BotÃ³n 1: Reporte de Ventas -->
                <a href="{% url 'reporte' %}" class="btn btn-warning fw-bold shadow-lg rounded-pill px-4">
                    ğŸ“Š Ver Cierre de Caja
                </a>

                <!-- BotÃ³n 2: Crear Nueva Mesa (Con confirmaciÃ³n) -->
                <a href="{% url 'crear_mesa' %}"
                   class="btn btn-outline-light fw-bold shadow-lg rounded-pill px-4"
                   onclick="return confirm('Â¿Confirmas crear una NUEVA mesa vacÃ­a?');">
                    ğŸ—ï¸ + Nueva Mesa
                </a>

            </div>
        {% endif %}

        <div class="row g-4 justify-content-center">
            {% for mesa in mesas %}
            <div class="col-12 col-sm-6 col-md-4 col-lg-3">

                <!-- LÃ“GICA VISUAL: Â¿Ocupada o Libre? -->
                <div class="card card-mesa shadow-lg p-3 {% if mesa.estado == 'ocupada' %}mesa-ocupada{% else %}mesa-libre{% endif %}">

                    <div class="card-body text-center d-flex flex-column justify-content-between">

                        <!-- TÃ­tulo de la Mesa -->
                        <h3 class="fw-bold mb-3" style="color: white">Mesa {{ mesa.numero }}</h3>

                        {% if mesa.estado == 'ocupada' %}
                            <!-- ESTADO OCUPADO -->
                            <div class="mb-3">
                                <span class="badge bg-danger badge-estado">ğŸ”´ Ocupada</span>
                            </div>
                            <div class="mb-4">
                                <small class="text-secondary d-block">Pendiente de Cobro</small>
                                <span class="precio-pendiente">${{ mesa.total_pendiente }}</span>
                            </div>

                            <!-- BOTONES DE ACCIÃ“N MESA OCUPADA -->
                            <div class="d-grid gap-2">
                                <a href="{% url 'menu' mesa.id %}" class="btn btn-primary fw-bold shadow-sm">
                                    â• Pedir MÃ¡s
                                </a>
                                <a href="{% url 'cuenta' mesa.id %}" class="btn btn-outline-danger fw-bold">
                                    ğŸ‘ï¸ Ver Cuenta
                                </a>
                            </div>

                        {% else %}
                            <!-- ESTADO LIBRE -->
                            <div class="mb-3">
                                <span class="badge bg-success badge-estado text-dark">ğŸŸ¢ Libre</span>
                            </div>
                            <div class="mb-4 text-secondary">
                                <small>Lista para clientes</small>
                                <div style="font-size: 2rem; opacity: 0.3;">ğŸª‘</div>
                            </div>
                            <!-- Enlace que cubre toda la tarjeta -->
                            <a href="{% url 'menu' mesa.id %}" class="btn btn-outline-success w-100 stretched-link">
                                ğŸš€ Ocupar Mesa
                            </a>
                        {% endif %}

                    </div>
                </div>

            </div>
            {% endfor %}
        </div>
    </div>

</body>
</html>